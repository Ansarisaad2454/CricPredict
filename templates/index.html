{% extends "base.html" %}

{% block title %}CricPredict - Cricket AI Assistant{% endblock %}

{% set active_page = 'chat' %}

{% block content %}
<div class="w-full max-w-6xl h-[85vh] glass-effect rounded-3xl shadow-2xl flex flex-col overflow-hidden animate-scale-in">

  <div class="bg-gradient-to-r from-blue-600/40 to-purple-600/40 backdrop-blur-md p-6 border-b border-white/10 animate-slide-down">
    <div class="flex items-center justify-center md:justify-start">
      <div>
        <h2 class="text-2xl md:text-3xl font-extrabold text-white drop-shadow-lg flex items-center gap-3">
          <span class="text-3xl">üèè</span>
          <span>Cricket AI Assistant</span>
        </h2>
        <p class="text-white/80 text-sm md:text-base mt-2 text-center md:text-left">Ask me anything about IPL, matches, players & statistics!</p>
      </div>
    </div>
  </div>

  <div id="chat-window" 
       class="flex-1 overflow-y-auto p-4 md:p-8 space-y-4" 
       role="log" 
       aria-live="polite" 
       aria-label="Chat messages">
    
    {% with role='Assistant', message=initial_message %}
      {% include 'partials/chat_message.html' %}
    {% endwith %}
    
  </div>

  <form
    hx-post="/chat"
    hx-target="#chat-window"
    hx-swap="beforeend"
    hx-indicator="#loading"
    hx-on::after-request="this.reset(); document.querySelector('#chat-input').focus();"
    hx-on::after-swap="const el = document.getElementById('chat-window'); el.scrollTo({top: el.scrollHeight, behavior: 'smooth'});"
    class="p-4 md:p-6 glass-effect border-t border-white/20 animate-slide-up"
    aria-label="Chat input form"
  >
    <div class="flex gap-3 items-end">
      <div class="flex-1">
        <label for="chat-input" class="sr-only">Enter your message</label>
        <input
          id="chat-input"
          name="query"
          type="text"
          placeholder="Ask about IPL winners, player stats, match predictions..."
          autofocus
          required
          autocomplete="off"
          class="w-full p-4 md:p-5 rounded-2xl glass-effect text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-yellow-400 text-base md:text-lg font-medium shadow-lg"
          aria-label="Chat message input"
        />
      </div>
      <button
        type="submit"
        class="relative px-6 md:px-8 py-4 md:py-5 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 text-gray-900 font-bold rounded-2xl hover:shadow-2xl hover:shadow-yellow-500/50 transform hover:scale-105 active:scale-95 transition-all duration-300 group overflow-hidden"
        aria-label="Send message"
      >
        <span class="relative z-10 flex items-center gap-2">
          <span class="hidden md:inline">Send</span>
          <svg class="w-5 h-5 md:w-6 md:h-6 transform group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
          </svg>
        </span>
        <div class="absolute inset-0 bg-gradient-to-r from-yellow-300 to-orange-400 opacity-0 group-hover:opacity-100 transition-opacity"></div>
      </button>
    </div>
    
    <div id="loading" 
         class="htmx-indicator mt-4 flex items-center justify-center gap-3 p-4 glass-effect rounded-xl"
         role="status"
         aria-label="Loading">
      <div class="spinner"></div>
      <span class="text-white/90 font-medium animate-pulse">AI is thinking...</span>
    </div>
  </form>
</div>

<script>
  // Auto-scroll to bottom on new messages
  const observer = new MutationObserver(() => {
    const chatWindow = document.getElementById('chat-window');
    chatWindow.scrollTo({top: chatWindow.scrollHeight, behavior: 'smooth'});
  });
  
  const chatWindow = document.getElementById('chat-window');
  if (chatWindow) {
    observer.observe(chatWindow, { childList: true, subtree: true });
  }
</script>
{% endblock %}